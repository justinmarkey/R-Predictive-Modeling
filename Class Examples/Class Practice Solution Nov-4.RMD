---
title: "Practice on Adult Data (Nov-4 in-class practice)"
output: 'word_document'
---

# Step 1: Create Train and Valid Data
```{r}
full.data<-read.csv("adult.csv",stringsAsFactors = TRUE)
full.data<-full.data[,-which(colnames(full.data) %in% c("EDUCATION","OCCUPATION"))]
```

Create train and validation:
```{r}
set.seed(347)
row_index<-sample(1:nrow(full.data),18000)
train<-full.data[row_index,]
valid<-full.data[-row_index,]
```


# Step 2: Stepwise Selection for best Logit model
```{r}
null_logit<-glm(ABOVE50K~1,
                family=binomial,
                data=train)
full_logit<-glm(ABOVE50K~.,
                family=binomial,
                data=train)
optimal_logit<-step(null_logit,
                    scope=list(upper=full_logit,
                               lower=null_logit),
                    direction="forward",
                    trace=FALSE
                    )
```

# Step 3: Evaluate the Performance:

## In-sample:
AIC:
```{r}
AIC(optimal_logit)
```

Macfadden's Pseudo RSquared:
```{r}
as.numeric(1-logLik(optimal_logit)/logLik(null_logit))
```

Confusion Matrix:
```{r}
actual_y<-train$ABOVE50K
pred_y<-predict(optimal_logit,type='response')
table(actual_y, pred_y>0.5)
```

Accuracy:
```{r}
sum(ifelse((actual_y==0&pred_y<=0.5)|(actual_y==1&pred_y>0.5),
  1,0))/nrow(train)
```

Sensitivity:
```{r}
sum(ifelse(actual_y==1&pred_y>0.5,1,0))/sum(actual_y)
```

Specificity:
```{r}
sum(ifelse(actual_y==0&pred_y<0.5,1,0))/(length(actual_y)-sum(actual_y))
```

ROC Curve:
```{r}
library(ROSE)
roc.curve(actual_y, pred_y)
```

Lift Chart:
```{r}
library(gains)
lift.table<-gains(actual=actual_y,predicted=pred_y,groups=10)
lift.table
```

Lift Chart (Extract Top Lift Only):
```{r}
lift.table$lift[1]
```

## Out-of-sample:
AIC and Macfadden's Pseudo RSquared are not applicable

Confusion Matrix
```{r}
actual_y<-valid$ABOVE50K
pred_y<-predict(optimal_logit,newdata=valid,type='response')
table(actual_y, pred_y>0.5)
```

Accuracy:
```{r}
sum(ifelse((actual_y==0&pred_y<=0.5)|(actual_y==1&pred_y>0.5),
  1,0))/nrow(train)
```

Sensitivity:
```{r}
sum(ifelse(actual_y==1&pred_y>0.5,1,0))/sum(actual_y)
```

Specificity:
```{r}
sum(ifelse(actual_y==0&pred_y<0.5,1,0))/(length(actual_y)-sum(actual_y))
```

ROC Curve
```{r}
library(ROSE)
roc.curve(actual_y, pred_y)
```

Lift Chart
```{r}
library(gains)
gains(actual=actual_y,predicted=pred_y,groups=10)
```

